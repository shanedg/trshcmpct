name: GitHub Actions CI (Staging Deploy)

# Run only one deploy to staging at a time
concurrency: staging-deploy-gate

on:
  push:
    branches:
    - 'stage/**'

jobs:
  stage-branch:
    uses: ./.github/workflows/branch.yml
    with:
      ENVIRONMENT: ${{ vars.ENVIRONMENT }}
    secrets: inherit

  stage-deploy:
    needs:
    - stage-branch
    uses: ./.github/workflows/deploy.yml
    with:
      ENVIRONMENT: ${{ vars.ENVIRONMENT }}
    secrets: inherit
